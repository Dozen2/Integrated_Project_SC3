# Build Stage
FROM node:20 AS builder

WORKDIR /app

# ğŸ‘‰ Copy package files à¸à¹ˆà¸­à¸™ à¹€à¸à¸·à¹ˆà¸­à¹ƒà¸Šà¹‰ cache à¸‚à¸­à¸‡ npm install
COPY package.json ./
COPY package-lock.json ./   

# ğŸ‘‰ Run npm install à¹à¸¢à¸à¹„à¸§à¹‰à¸•à¸£à¸‡à¸™à¸µà¹‰ (Docker cache à¸—à¸³à¸‡à¸²à¸™à¹„à¸”à¹‰à¸”à¸µ)
RUN npm install

# ğŸ‘‰ Copy source code à¸—à¸µà¸«à¸¥à¸±à¸‡
COPY . .

# ğŸ‘‰ Build Project
RUN npm run build -- --base=/sc3/

# Runtime Stage
FROM nginx:stable-alpine

RUN rm -rf /usr/share/nginx/html/

COPY --from=builder /app/dist /usr/share/nginx/html/

COPY nginx.conf /etc/nginx/conf.d/default.conf

EXPOSE 80

CMD ["nginx", "-g", "daemon off;"]
